(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{1543:function(e,t,n){"use strict";var i=n("2591"),o={apiKey:"AIzaSyC3mSqN_lKIPC7ml2LH5iaQj7c85lRu_50",authDomain:"templit-697dc.firebaseapp.com",databaseURL:"https://templit-697dc.firebaseio.com",projectId:"templit-697dc",storageBucket:"templit-697dc.appspot.com",messagingSenderId:"673698949280",appId:"1:673698949280:web:6da4c034a879d4bdfa01c5",measurementId:"G-0P33MV38MC"};t["a"]=i["a"].apps.length?i["a"].app():i["a"].initializeApp(o)},2960:function(e,t,n){},"3ade":function(e,t,n){},"4d4e":function(e,t,n){},"6a0e":function(e,t,n){"use strict";n("b1af")},"8fb8":function(e,t,n){"use strict";n("4d4e")},ad0c:function(e,t,n){"use strict";n("3ade")},b1af:function(e,t,n){},cabd:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-layout",{staticClass:"outer-layout",attrs:{view:"lHh Lpr lFf"}},[n("q-header",{staticClass:"bg-white header",attrs:{elevated:""}},[n("q-toolbar",{staticClass:"text-black q-py-sm"},[n("q-btn",{attrs:{flat:"",color:"white","text-color":"primary",icon:"home",round:"",to:"/"}}),n("q-toolbar-title",{staticClass:"text-weight-bold"},[e._v("\n        "+e._s(e.documentName)+"\n      ")]),n("AvatarRow"),n("q-btn",{attrs:{flat:"",color:"white","text-color":"primary",icon:"download",round:""}},[n("q-menu",{attrs:{anchor:"bottom middle",self:"top middle"}},[n("q-list",{staticStyle:{"min-width":"120px"},attrs:{dense:""}},[n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:e.savePdf}},[n("q-item-section",[e._v("Save PDF")])],1),n("q-separator"),n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:e.saveMarkdown}},[n("q-item-section",[e._v("Save Markdown")])],1),n("q-separator"),n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:e.restoreFromLocal}},[n("q-item-section",[e._v("Recover File")])],1),n("q-separator")],1)],1)],1),n("q-btn",{attrs:{flat:"",color:"white","text-color":"primary",icon:"save",round:""},on:{click:e.saveLocally}})],1)],1),n("q-page-container",{staticClass:"outer-page-container"},[n("q-page",{staticClass:"outer-page"},[n("div",{staticClass:"doc-outer"},[n("div",{staticClass:"doc-editor"},[n("DocumentEditor",{ref:"docEditor",attrs:{documentId:e.docId},on:{"contents-loaded":function(t){e.loading=!1},input:e.updatePreview,update:e.updatePreview,save:e.saveLocally}})],1),n("div",{staticClass:"doc-preview"},[n("DocumentPreview",{attrs:{content:e.contents}})],1)])]),n("q-inner-loading",{staticStyle:{"z-index":"10"},attrs:{showing:e.loading}},[n("q-spinner",{attrs:{size:"50px",color:"primary",thickness:10}}),n("div",{staticClass:"text-center text-h6 q-mt-md"},[e._v("\n        Fetching document...\n      ")])],1)],1)],1)},o=[],a=(n("ac1f"),n("1276"),n("498a"),n("5a0c"),n("a002")),s=n.n(a),r=n("21a6"),c=n.n(r),l=n("1543"),d=n("cc8f"),u=n("f430"),m=n("ecf6"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("AceEditor",{ref:"aceEditor",attrs:{name:"editor",width:"100%",height:"100%",lang:"markdown",theme:"dracula",options:e.editorOptions,commands:e.commands},on:{init:e.editorInit,input:e.handleInput},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})},f=[],h=(n("99af"),n("fb6a"),n("d3b7"),n("e6cf"),n("96cf"),n("c973")),v=n.n(h),g=n("c17d"),w=n.n(g),b={name:"DocumentEditor",mixins:[u["a"]],components:{AceEditor:w.a},props:{documentId:{type:String,required:!0}},data:function(){return{content:"",editorOptions:{selectionStyle:"line",highlightActiveLine:!0,highlightSelectedWord:!0,readOnly:!1,cursorStyle:"ace",mergeUndoDeltas:!0,behavioursEnabled:!0,wrapBehavioursEnabled:!0,autoScrollEditorIntoView:void 0,animatedScroll:!1,displayIndentGuides:!0,showInvisibles:!1,showPrintMargin:!1,printMarginColumn:80,printMargin:void 0,showGutter:!0,fadeFoldWidgets:!1,showFoldWidgets:!0,showLineNumbers:!0,highlightGutterLine:!0,hScrollBarAlwaysVisible:!1,vScrollBarAlwaysVisible:!1,fontSize:17,fontFamily:void 0,maxLines:void 0,minLines:void 0,scrollPastEnd:0,fixedWidthGutter:!1,scrollSpeed:2,dragDelay:0,dragEnabled:!0,focusTimout:0,tooltipFollowsMouse:!0,firstLineNumber:1,overwrite:!1,newLineMode:"auto",useWorker:!0,useSoftTabs:!0,tabSize:4,wrap:!0,indentedSoftWrap:!0,foldStyle:"markbegin"},commands:[{name:"save",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:this.saveData,readOnly:!1}]}},computed:{canEdit:function(){return!(this.readOnly||this.$q.platform.is.mobile||this.isOffline)}},methods:{saveData:function(){this.$emit("save")},handleInput:function(e){this.$emit("input",e)},setDocument:function(e){var t=this;t.content=e},editorInit:function(){n("2099"),n("be9d"),n("c1a9"),n("d067"),n("e1a9"),n("0950")},initializeConnection:function(){var e=this,t=e.$refs.aceEditor.editor,n=e.uid,i=e.timestamp,o=l["a"].database(),a=this.documentId,s=o.ref("documents"),r=s.child(a),c=r.child("queue"),d=!1,u=1/30,m=i-60*u*60*1e3,p=c.orderByChild("timestamp").endAt(m).limitToLast(1);p.on("child_added",(function(e){e.ref.remove()})),r.child("content").once("value",(function(o){e.$emit("contents-loaded"),t.on("change",function(){var i=v()(regeneratorRuntime.mark((function i(o){var a;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(e.$emit("update",t.getValue()),!d){i.next=3;break}return i.abrupt("return");case 3:if(i.t0="remove"===o.action&&""===t.getValue()&&!(0===o.end.row&&1===o.end.column),!i.t0){i.next=8;break}return i.next=7,e.confirmDeletion();case 7:i.t0=!i.sent;case 8:if(!i.t0){i.next=11;break}return window.location.reload(!0),i.abrupt("return");case 11:e.canEdit&&(r.update({content:t.getValue()}),a=Date.now(),c.child("".concat(a,":").concat(String(Math.random()).slice(2))).set({changes:o,by:n,timestamp:a}).catch((function(e){console.error(e)})));case 12:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()),c.on("child_added",(function(e){var o=e.key.split(":")[0];if(!(i>o)){var a=e.val();a.by!==n&&(d=!0,a.changes&&t.getSession().getDocument().applyDeltas([a.changes]),d=!1)}})),d=!0,t.setValue(o.val()||"",-1),t.focus(),d=!1}))},confirmDeletion:function(){var e=this;return new Promise((function(t){e.$q.dialog({title:"Confirm",message:"Are you sure you want to delete the contents of this document?",cancel:!0,persistent:!0}).onOk((function(){return t(!0)})).onCancel((function(){return t(!1)}))}))},setReadOnly:function(e){this.editorOptions.readOnly=e,this.$refs.aceEditor.editor.setOptions({readOnly:e})}},mounted:function(){this.setReadOnly(this.readOnly),this.initializeConnection()},watch:{readOnly:function(e){this.setReadOnly(e)}}},y=b,k=(n("6a0e"),n("2877")),q=Object(k["a"])(y,p,f,!1,null,null,null),C=q.exports,x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"preview"},[n("Markdown",{staticClass:"markdown-body",attrs:{content:e.content,options:e.options}})],1)},O=[],I=n("48cd"),S=n.n(I),L=n("1487"),E=n.n(L),_=function(e,t){if(t&&E.a.getLanguage(t))try{return E.a.highlight(t,e).value}catch(n){console.error(n)}try{return E.a.highlightAuto(e).value}catch(n){console.error(n)}return""},M={name:"Preview",components:{Markdown:S.a},props:{content:{type:String}},data:function(){return{options:{markdownIt:{highlight:_,html:!0,linkify:!0,breaks:!0},linkAttributes:{attrs:{target:"_blank",rel:"noopener"}}}}}},P=M,R=(n("ad0c"),Object(k["a"])(P,x,O,!1,null,null,null)),D=R.exports,A={name:"PageDocument",mixins:[u["a"],d["a"]],components:{AvatarRow:m["a"],DocumentEditor:C,DocumentPreview:D},props:{docId:{type:String,required:!0}},data:function(){return{loading:!0,contents:""}},computed:{documentName:function(){return this.docId.split(":")[0]}},methods:{updatePreview:function(e){this.contents=e},saveLocally:function(){var e=this,t=this.$refs.docEditor.content;t.trim()?s.a.setItem(e.docId,t).then((function(){e.showMessage('Locally saved "'.concat(e.documentName,'!"'),"positive")})).catch((function(t){e.showMessage(),console.log(t)})):e.showMessage('Locally saved "'.concat(e.documentName,'!"'),"positive")},restoreFromLocal:function(){var e=this;e.$refs.docEditor;e.$q.dialog({title:"Recovering",message:'Recovering will generate a Markdown file containing the contents from the last time you saved. Press "OK" to proceed.',cancel:!0}).onOk((function(){s.a.getItem(e.docId).then((function(t){t?(e.showMessage("Contents recovered!","positive"),e.saveRecoveryFile(t)):e.showMessage("Nothing to restore")})).catch((function(t){e.showMessage(),console.log(t)}))}))},saveFile:function(e,t){var n=t+".md",i=new Blob([e],{type:"text/plain;charset=utf-8"});c.a.saveAs(i,n)},saveRecoveryFile:function(e){var t="RECOVERY - "+this.documentName;this.saveFile(e,t)},saveMarkdown:function(){this.saveFile(this.contents,this.documentName)},savePdf:function(){window.print()}},mounted:function(){document.title=this.documentName},beforeRouteLeave:function(e,t,n){document.title="Templit",n()}},$=A,F=(n("df27"),n("4d5a")),Q=n("e359"),N=n("65c6"),U=n("9c40"),j=n("6ac5"),z=n("4e73"),V=n("1c1c"),T=n("66e5"),B=n("4074"),W=n("eb85"),G=n("09e3"),K=n("9989"),H=n("74f7"),J=n("0d59"),Y=n("7f67"),X=n("eebe"),Z=n.n(X),ee=Object(k["a"])($,i,o,!1,null,null,null);t["default"]=ee.exports;Z()(ee,"components",{QLayout:F["a"],QHeader:Q["a"],QToolbar:N["a"],QBtn:U["a"],QToolbarTitle:j["a"],QMenu:z["a"],QList:V["a"],QItem:T["a"],QItemSection:B["a"],QSeparator:W["a"],QPageContainer:G["a"],QPage:K["a"],QInnerLoading:H["a"],QSpinner:J["a"]}),Z()(ee,"directives",{ClosePopup:Y["a"]})},cc8f:function(e,t,n){"use strict";n.d(t,"b",(function(){return i}));var i={methods:{showMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Uh oh, something went wrong",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"negative",n=this.$q.screen.gt.xs?"top":"bottom";this.$q.notify({message:e,color:t,position:n,timeout:2e3,actions:[{label:"",icon:"close",color:"white",dense:!0,handler:function(){}}]})}}};t["a"]=i},df27:function(e,t,n){"use strict";n("2960")},ecf6:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.isOffline?n("div",{staticClass:"text-weight-bold text-grey-5"},[e._v("\n    You're offline\n  ")]):n("div",{staticClass:"avatar-row q-mr-sm"},[n("v-animal",{key:e.uid,staticClass:"current-user",attrs:{name:e.currentUserAnimal,color:e.currentUserColor,dance:"",size:"40px"}}),e._l(e.userObjects,(function(e){return n("v-animal",{key:e.key,attrs:{name:e.name,color:e.color,size:"40px"}})})),e.remainingUsers>0?n("div",{staticClass:"user-overflow"},[e._v("\n      +"+e._s(e.remainingUsers)+"\n    ")]):e._e()],2)])},o=[],a=(n("4de4"),n("d81d"),n("fb6a"),n("ac1f"),n("1276"),n("3b6c")),s=n.n(a),r=n("f430"),c=7,l={name:"AvatarRow",mixins:[r["a"]],components:{"v-animal":s.a},computed:{cappedList:function(){var e=this,t=this.users.filter((function(t){return t.key!==e.uid+":"+e.timestamp}));return t.slice(0,c)},userObjects:function(){return this.cappedList.map((function(e){var t=e.uid.split(" ");return{key:e.key,color:t[0],name:t[1]}}))},remainingUsers:function(){return this.users.length-c},currentUserColor:function(){return this.uid.split(" ")[0]},currentUserAnimal:function(){return this.uid.split(" ")[1]}},methods:{isCurrentUser:function(e){return this.uid===e}}},d=l,u=(n("8fb8"),n("2877")),m=Object(u["a"])(d,i,o,!1,null,null,null);t["a"]=m.exports},f430:function(e,t,n){"use strict";var i=n("ded3"),o=n.n(i),a=n("2f62"),s={computed:o()({},Object(a["c"])("store",["uid","users","timestamp","isOffline","readOnly"])),methods:o()({},Object(a["b"])("store",["setUser","addUser","removeUser","setTimestamp","setIsOffline","setReadOnly"]))};t["a"]=s}}]);